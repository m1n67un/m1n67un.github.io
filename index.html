<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한국 전통 달력 섹션</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .calendar-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            max-width: 600px;
            width: 100%;
        }
        .logo-container {
            text-align: center;
            padding: 30px 0;
            background-color: #ffffff;
        }
        .input-container {
            padding: 20px;
            background-color: #f8f8f8;
            border-bottom: 1px solid #e0e0e0;
        }
        .input-container input {
            width: 97%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .calendar-header, .calendar-footer {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            border-bottom: 1px solid #e0e0e0;
        }
        .calendar-footer {
            border-top: 1px solid #e0e0e0;
            border-bottom: none;
        }
        .calendar-header-item, .calendar-footer-item {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border-right: 1px solid #e0e0e0;
        }
        .calendar-header-item:last-child, .calendar-footer-item:last-child {
            border-right: none;
        }
        .calendar-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
        }
        .calendar-item {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-right: 1px solid #e0e0e0;
        }
        .calendar-item:last-child {
            border-right: none;
        }
        svg {
            max-width: 100%;
            height: auto;
        }
    </style>

    <script>
        class Manseryk {
            constructor() {
                this.heavenly_stems = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
                this.earthly_branches = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
            }

            get_year_ganji(year, month, day) {
                let adjusted_year = (month === 1 || (month === 2 && day < 4)) ? year - 1 : year;
                let stem_index = (adjusted_year - 4) % 10;
                let branch_index = (adjusted_year - 4) % 12;
                let stem = this.heavenly_stems[stem_index];
                let branch = this.earthly_branches[branch_index];
                return `${stem}${branch}`;
            }

            get_month_ganji(year, month, day) {
                const base_year = 1984;
                let months_since_base = (year - base_year) * 12 + month - 1;
                
                let stem_index = months_since_base % 10;
                let branch_index = month - 1;

                if (day > 7) {
                    stem_index = (stem_index + 1) % 10;
                    branch_index = (branch_index + 1) % 12;
                }

                return `${this.heavenly_stems[stem_index]}${this.earthly_branches[branch_index]}`;
            }

            get_day_ganji(year, month, day) {
                const base_date = new Date(1984, 0, 31); // JavaScript months are 0-indexed
                const target_date = new Date(year, month - 1, day);
                const days_since_base = Math.floor((target_date - base_date) / (1000 * 60 * 60 * 24));
                const stem_index = days_since_base % 10;
                const branch_index = days_since_base % 12;
                return `${this.heavenly_stems[stem_index]}${this.earthly_branches[branch_index]}`;
            }

            get_manseryk(year, month, day) {
                const year_ganji = this.get_year_ganji(year, month, day);
                const month_ganji = this.get_month_ganji(year, month, day);
                const day_ganji = this.get_day_ganji(year, month, day);
                return [year_ganji, month_ganji, day_ganji];
            }
        }

        function splitDateTime(dateTimeString) {
            if (dateTimeString.length !== 12) {
                throw new Error("입력 문자열은 정확히 12자리여야 합니다.");
            }

            const year = dateTimeString.slice(0, 4);
            const month = dateTimeString.slice(4, 6);
            const day = dateTimeString.slice(6, 8);
            const hour = dateTimeString.slice(8, 10);
            const minute = dateTimeString.slice(10, 12);

            return {
                year: year,
                month: month,
                day: day,
                hour: hour,
                minute: minute
            };
        }

        function setColor(value) {
            let green = ["甲", "乙", "寅", "卯"];
            let yellow = ["戊", "己", "丑", "辰", "未", "戌"];
            let red = ["丙", "丁", "巳", "午"];
            let brack = ["壬", "癸", "子", "亥"];
            let white = ["庚", "辛", "申", "酉"];

            if(green.includes(value)) {
                return "white";
            }
            if(yellow.includes(value)) {
                return "black";
            }
            if(red.includes(value)) {
                return "white";
            }
            if(brack.includes(value)) {
                return "white";
            }
            if(white.includes(value)) {
                return "black";
            }
        }


        function setBgColor(value) {
            let green = ["甲", "乙", "寅", "卯"];
            let yellow = ["戊", "己", "丑", "辰", "未", "戌"];
            let red = ["丙", "丁", "巳", "午"];
            let brack = ["壬", "癸", "子", "亥"];
            let white = ["庚", "辛", "申", "酉"];

            if(green.includes(value)) {
                return "green";
            }
            if(yellow.includes(value)) {
                return "yellow";
            }
            if(red.includes(value)) {
                return "red";
            }
            if(brack.includes(value)) {
                return "brack";
            }
            if(white.includes(value)) {
                return "white";
            }
        }

        function main() {
            let dateTimeString = document.querySelector("#birth").value;
            const result = splitDateTime(dateTimeString);
            const manseryk = new Manseryk();
            const [year_ganji, month_ganji, day_ganji] = manseryk.get_manseryk(Number(result.year), Number(result.month), Number(result.day));
            console.log(`${result.year}년 ${result.month}월 ${result.day}일:`);
            console.log(`년: ${year_ganji}`);
            console.log(`월: ${month_ganji}`);
            console.log(`일: ${day_ganji}`);

            document.querySelector("#top-year").textContent = year_ganji[0];
            document.querySelector("#top-year").parentNode.querySelector('rect').setAttribute('fill', setBgColor(year_ganji[0]));
            document.querySelector("#top-year").setAttribute('fill', setColor(year_ganji[0]));

            document.querySelector("#top-month").textContent = month_ganji[0];
            document.querySelector("#top-month").parentNode.querySelector('rect').setAttribute('fill', setBgColor(month_ganji[0]));
            document.querySelector("#top-month").setAttribute('fill', setColor(month_ganji[0]));

            document.querySelector("#top-day").textContent = day_ganji[0];
            document.querySelector("#top-day").parentNode.querySelector('rect').setAttribute('fill', setBgColor(day_ganji[0]));
            document.querySelector("#top-day").setAttribute('fill', setColor(day_ganji[0]));

            document.querySelector("#bottom-year").textContent = year_ganji[1];
            document.querySelector("#bottom-year").parentNode.querySelector('rect').setAttribute('fill', setBgColor(year_ganji[1]));
            document.querySelector("#bottom-year").setAttribute('fill', setColor(year_ganji[1]));

            document.querySelector("#bottom-month").textContent = month_ganji[1];
            document.querySelector("#bottom-month").parentNode.querySelector('rect').setAttribute('fill', setBgColor(month_ganji[1]));
            document.querySelector("#bottom-month").setAttribute('fill', setColor(month_ganji[1]));

            document.querySelector("#bottom-day").textContent = day_ganji[1];
            document.querySelector("#bottom-day").parentNode.querySelector('rect').setAttribute('fill', setBgColor(day_ganji[1]));
            document.querySelector("#bottom-day").setAttribute('fill', setColor(day_ganji[1]));

            const saju = new Saju("癸", "酉", "甲", "子", "丙", "子", "壬", "辰");
            const tenGods = saju.getTenGods();

            for (const [pillar, gods] of Object.entries(tenGods)) {
                console.log(`${pillar}: 천간 - ${gods.stem}, 지지 - ${gods.branch}`);

                switch (pillar) {
                    case "년주":
                        document.querySelector("#top-year-ss").textContent = gods.stem;
                        document.querySelector("#bottom-year-ss").textContent = gods.branch;
                    break;
                    case "월주":
                        document.querySelector("#top-month-ss").textContent = gods.stem;
                        document.querySelector("#bottom-month-ss").textContent = gods.branch;
                    break;
                    case "일주":
                        document.querySelector("#bottom-day-ss").textContent = gods.branch;
                    break;
                    case "시주":
                    
                    break;
                    default:
                        break;
                }
            }
        }

        class Saju {
            constructor(yearStem, yearBranch, monthStem, monthBranch, dayStem, dayBranch, hourStem, hourBranch) {
                this.yearStem = yearStem;
                this.yearBranch = yearBranch;
                this.monthStem = monthStem;
                this.monthBranch = monthBranch;
                this.dayStem = dayStem;
                this.dayBranch = dayBranch;
                this.hourStem = hourStem;
                this.hourBranch = hourBranch;
            }

            getStemTenGods(dayStem, otherStem) {
                const stems = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
                const tenGods = ["비견", "겁재", "식신", "상관", "편재", "정재", "칠살", "정관", "편인", "정인"];
                
                const dayIndex = stems.indexOf(dayStem);
                const otherIndex = stems.indexOf(otherStem);
                
                const godIndex = (otherIndex + 10 - dayIndex) % 10;
                return tenGods[godIndex];
            }

            getBranchTenGods(dayStem, branch) {
                const branchHiddenStems = {
                    "子": ["癸"],
                    "丑": ["己", "癸", "辛"],
                    "寅": ["甲", "丙", "戊"],
                    "卯": ["乙"],
                    "辰": ["戊", "乙", "癸"],
                    "巳": ["丙", "庚", "戊"],
                    "午": ["丁", "己"],
                    "未": ["己", "丁", "乙"],
                    "申": ["庚", "壬", "戊"],
                    "酉": ["辛"],
                    "戌": ["戊", "辛", "丁"],
                    "亥": ["壬", "甲"]
                };

                const hiddenStems = branchHiddenStems[branch];
                return hiddenStems.map(stem => this.getStemTenGods(dayStem, stem)).join(", ");
            }

            getTenGods() {
                const result = {};
                
                result["년주"] = {
                    stem: this.getStemTenGods(this.dayStem, this.yearStem),
                    branch: this.getBranchTenGods(this.dayStem, this.yearBranch)
                };
                result["월주"] = {
                    stem: this.getStemTenGods(this.dayStem, this.monthStem),
                    branch: this.getBranchTenGods(this.dayStem, this.monthBranch)
                };
                result["일주"] = {
                    stem: "일주",
                    branch: this.getBranchTenGods(this.dayStem, this.dayBranch)
                };
                result["시주"] = {
                    stem: this.getStemTenGods(this.dayStem, this.hourStem),
                    branch: this.getBranchTenGods(this.dayStem, this.hourBranch)
                };

                return result;
            }
        }
    </script>
</head>
<body>
    <div class="calendar-section">
        <div class="logo-container">
            <svg width="200" height="60" viewBox="0 0 200 60">
                <defs>
                    <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#4285F4;stop-opacity:1" />
                        <stop offset="25%" style="stop-color:#34A853;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#FBBC05;stop-opacity:1" />
                        <stop offset="75%" style="stop-color:#EA4335;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#4285F4;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <text x="40" y="45" font-family="'Noto Sans KR', sans-serif" font-size="40" font-weight="400" fill="#5F6368">사주</text>
                <text x="130" y="45" font-family="'Noto Sans KR', sans-serif" font-size="40" font-weight="700" fill="url(#logo-gradient)">핑</text>
            </svg>
        </div>
        <div class="input-container">
            <input type="text" id="birth" placeholder="생년월일시 입력 (예: 199001011200)" pattern="\d{12}" maxlength="12" required onkeydown="main()">
        </div>
        <div class="calendar-header">
            <div class="calendar-header-item">?</div>
            <div class="calendar-header-item">일간</div>
            <div class="calendar-header-item" id="top-month-ss">정인</div>
            <div class="calendar-header-item" id="top-year-ss">길제</div>
        </div>
        <div class="calendar-content">
            <div class="calendar-item">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <rect width="80" height="80" fill="white" stroke="#000" stroke-width="2"></rect>
                    <text x="40" y="40" font-size="36" fill="black" text-anchor="middle" dominant-baseline="central">?</text>
                </svg>
            </div>
            <div class="calendar-item">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <rect width="80" height="80" fill="#FFFFFF" stroke="#000" stroke-width="2"></rect>
                    <text x="40" y="40" font-size="36" fill="#000" text-anchor="middle" dominant-baseline="central" id="top-day">辛</text>
                </svg>
            </div>
            <div class="calendar-item">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <rect width="80" height="80" fill="#FFC107" stroke="#000" stroke-width="2"></rect>
                    <text x="40" y="40" font-size="36" fill="#FFF" text-anchor="middle" dominant-baseline="central" id="top-month">戌</text>
                </svg>
            </div>
            <div class="calendar-item">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <rect width="80" height="80" fill="#F44336" stroke="#000" stroke-width="2"></rect>
                    <text x="40" y="40" font-size="36" fill="#FFF" text-anchor="middle" dominant-baseline="central" id="top-year">庚</text>
                </svg>
            </div>
        </div>
        <div class="calendar-content">
            <div class="calendar-item">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <rect width="80" height="80" fill="white" stroke="#000" stroke-width="2"></rect>
                    <text x="40" y="40" font-size="36" fill="black" text-anchor="middle" dominant-baseline="central">?</text>
                </svg>
            </div>
            <div class="calendar-item">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <rect width="80" height="80" fill="#FFFFFF" stroke="#000" stroke-width="2"></rect>
                    <text x="40" y="40" font-size="36" fill="#000" text-anchor="middle" dominant-baseline="central" id="bottom-day">亥</text>
                </svg>
            </div>
            <div class="calendar-item">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <rect width="80" height="80" fill="#FFC107" stroke="#000" stroke-width="2"></rect>
                    <text x="40" y="40" font-size="36" fill="#FFF" text-anchor="middle" dominant-baseline="central" id="bottom-month">子</text>
                </svg>
            </div>
            <div class="calendar-item">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <rect width="80" height="80" fill="#F44336" stroke="#000" stroke-width="2"></rect>
                    <text x="40" y="40" font-size="36" fill="#FFF" text-anchor="middle" dominant-baseline="central" id="bottom-year">戌</text>
                </svg>
            </div>
        </div>
        <div class="calendar-footer">
            <div class="calendar-footer-item">?</div>
            <div class="calendar-footer-item" id="bottom-day-ss">월건(납)</div>
            <div class="calendar-footer-item" id="bottom-month-ss">정인</div>
            <div class="calendar-footer-item" id="bottom-year-ss">길제</div>
        </div>
    </div>
</body>
</html>